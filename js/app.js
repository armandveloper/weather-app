const $app=document.getElementById("app"),$form=document.getElementById("form"),$input=document.getElementById("input-place"),$weatherIcon=document.getElementById("weather-icon"),$weatherDescription=document.getElementById("weather-description"),$weatherPlace=document.getElementById("weather-place"),$weatherTemp=document.getElementById("weather-temp"),$weatherDateTime=document.getElementById("weather-datetime"),$weatherCloudy=document.getElementById("weather-cloudy"),$weatherHumidity=document.getElementById("weather-humidity"),$weatherWind=document.getElementById("weather-wind"),$loader=document.getElementById("loader");let $weatherImg=document.getElementById("weather-img");const key="8c9fcb7a328362b6325eef63a706146c",conditionCodes={Clouds:{icon:"icons/clouds.svg",cover:"img/clouds.jpg"},Clear:{icon:"icons/clear.svg",cover:"img/clear.jpg"},Snow:{icon:"icons/snow.svg",cover:"img/snow.jpg"},Rain:{icon:"icons/rain.svg",cover:"img/rain.jpg"},Drizzle:{icon:"icons/drizzle.svg",cover:"img/drizzle.jpg"},Thunderstorm:{icon:"icons/thunderstorm.svg",cover:"img/thunderstorm.jpg"},Fog:{icon:"icons/fog.svg",cover:"img/fog.jpg"}},months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Nov","Oct","Dec"],days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],permissionKey="allowLocation",showToast=e=>{const t=document.createElement("div");t.className="toast",t.innerText=e,document.body.appendChild(t),setTimeout(()=>{t.classList.add("fadeOutDown"),setTimeout(()=>{t.remove()},400)},2e3)},renderResult=(e,t)=>{if("404"===e.cod)return showToast("No results found");const{weather:n,main:o,name:a,clouds:i,wind:r}=e;let s=n[0].main;s="Mist"===s?"Fog":s;const{cover:c,icon:d}=conditionCodes[s];if(t)$weatherImg.src=c;else{const e=new Image(innerWidth,innerHeight);e.className="weather__img weather__img--in",e.alt="Weather cover",e.src=c,e.id="weather-img",e.onload=(()=>{$app.insertAdjacentElement("afterbegin",e),$weatherImg.classList.add("weather__img--out"),setTimeout(()=>{$weatherImg.remove(),($weatherImg=e).classList.remove("weather__img--in")},400)})}$weatherIcon.src=d,$weatherDescription.innerText=n[0].main,$weatherTemp.innerHTML=`\n    ${o.temp}<sup class="weather__grades">Â°</sup>\n  `,$weatherPlace.innerText=a,$weatherCloudy.innerText=i.all+"%",$weatherHumidity.innerText=o.humidity+"%",$weatherWind.innerText=(3.6*r.speed).toFixed(2)+"Km/h"},getWeather=async e=>{try{const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURI(e)}&units=metric&appid=${key}`),n=await t.json();renderResult(n)}catch(e){console.log(e)}},getWeatherByCoords=async(e,t)=>{try{const n=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${e}&lon=${t}&units=metric&appid=${key}`),o=await n.json();renderResult(o,!0),$loader.remove()}catch(e){console.log(e)}},handleSubmit=e=>{e.preventDefault();const t=$input.value.trim();t?(getWeather(t),$form.reset()):showToast("Please enter a location")},generateDateTime=()=>{const e=new Date,t=e.getUTCFullYear().toString().substring(2),n=months[e.getMonth()],o=days[e.getDay()],a=e.getDate(),i=e.getHours(),r=e.getMinutes();$weatherDateTime.innerText=`${i<10?"0"+i:i}:${r<10?"0"+r:r} - ${o}, ${a<10?"0"+a:a} ${n} ${t}`},getPosition=e=>{navigator.geolocation.getCurrentPosition(({coords:t})=>{e&&e.remove(),getWeatherByCoords(t.latitude,t.longitude)},t=>{e.innerHTML='\n        <div class="alert">\n          <p>Permission was denied, please configure the permission in your browser</p>\n        </div>\n      '})},updatePermissions=({target:e})=>{localStorage.setItem(permissionKey,"granted"===e.state)},requestPositionAccess=()=>{const e=document.getElementById("alert");e.firstElementChild.remove(),navigator.permissions.query({name:"geolocation"}).then(function(t){t.onchange=updatePermissions,"granted"===t.state?getPosition(e):"denied"===t.state?e.innerHTML=e.innerHTML='\n        <div class="alert">\n        <p>Permission was denied, please configure the permission in your browser</p>\n        </div>\n      ':getPosition(e)})},showAlert=()=>{const e=document.createElement("div");e.className="overlay",e.id="alert",e.innerHTML='\n  <div class="alert">\n  <p>Please, provide access of your location for use the app.</p>\n    <button class="btn--access" onclick="requestPositionAccess()">Allow</button>\n  </div>\n',document.body.appendChild(e)},allowLocation=JSON.parse(localStorage.getItem(permissionKey))||!1;allowLocation?getPosition():showAlert(),generateDateTime(),setInterval(generateDateTime,6e4),$form.addEventListener("submit",handleSubmit);